<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AR Tong Sampah</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      body, html { margin: 0; height: 100%; overflow: hidden; }
      #ui {
        position: fixed; top: 12px; left: 50%; transform: translateX(-50%);
        display: flex; gap: 8px; z-index: 10;
        background: rgba(0,0,0,0.4); padding: 8px 10px; border-radius: 10px;
        backdrop-filter: blur(4px);
      }
      .btn {
        appearance: none; border: 0; border-radius: 8px; padding: 10px 14px;
        font-size: 14px; font-weight: 600; cursor: pointer; color: #111;
        background: #f0f0f0; box-shadow: 0 1px 2px rgba(0,0,0,.15);
        transition: transform .15s ease, background-color .15s ease, box-shadow .15s ease;
      }
      .btn:hover { background: #e5e7eb; box-shadow: 0 2px 6px rgba(0,0,0,.2); transform: translateY(-1px); }
      .btn:active, .btn.pressed { background: #d1d5db; transform: translateY(0); box-shadow: 0 1px 2px rgba(0,0,0,.15); }
    </style>
  </head>
  <body>
    <div id="ui">
      <button id="btn-organik" class="btn">Organik</button>
      <button id="btn-anorganik" class="btn">Anorganik</button>
      <button id="btn-kertas" class="btn">Kertas</button>
      <button id="btn-marker" class="btn" title="Buka marker Hiro">Marker Hiro</button>
      
    </div>

    <a-scene embedded arjs="trackingMethod: best; sourceType: webcam; videoTexture: true; debugUIEnabled: false;">
      <a-camera gps-new-camera="gpsMinDistance: 5" id="gps-camera"></a-camera>
      <a-marker id="hiro-marker" preset="hiro" emitevents="true"></a-marker>
      <a-marker id="hiro-marker" preset="hiro" emitevents="true"></a-marker>
      <a-entity id="bin-organik"
                gltf-model="assets/models/bin-organik.glb"
                rotation="0 0 0"
                scale="0.03 0.03 0.03"
                visible="false"></a-entity>
      <a-entity id="bin-anorganik"
                gltf-model="assets/models/bin-anorganik.glb"
                rotation="0 0 0"
                scale="0.03 0.03 0.03"
                visible="false"></a-entity>
      <a-entity id="bin-kertas"
                gltf-model="assets/models/bin-kertas.glb"
                rotation="0 0 0"
                scale="0.03 0.03 0.03"
                visible="false"></a-entity>
    </a-scene>

    <script>
      const entities = {
        organik: document.getElementById('bin-organik'),
        anorganik: document.getElementById('bin-anorganik'),
        kertas: document.getElementById('bin-kertas'),
      };
      function showModel(name) {
        Object.values(entities).forEach(e => e.setAttribute('visible', false));
        const target = entities[name];
        if (target) {
          target.setAttribute('rotation', '0 0 0');
          target.setAttribute('visible', true);
        }
      }
      document.getElementById('btn-organik').addEventListener('click', () => showModel('organik'));
      document.getElementById('btn-anorganik').addEventListener('click', () => showModel('anorganik'));
      document.getElementById('btn-kertas').addEventListener('click', () => showModel('kertas'));
      document.getElementById('btn-marker').addEventListener('click', () => window.open('hiro-marker.html', '_blank'));
      Array.from(document.querySelectorAll('.btn')).forEach(b => {
        b.addEventListener('pointerdown', () => b.classList.add('pressed'));
        b.addEventListener('pointerup', () => b.classList.remove('pressed'));
        b.addEventListener('pointerleave', () => b.classList.remove('pressed'));
      });
      let coordsReady = false;
      let userLat = null, userLon = null;
      function setLocationEntities(lat, lon) {
        const meters = 3;
        const dLat = meters / 111111;
        const dLon = meters / (111111 * Math.cos(lat * Math.PI / 180));
        entities.organik.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lon - dLon}`);
        entities.anorganik.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lon}`);
        entities.kertas.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lon + dLon}`);
      }
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => { userLat = pos.coords.latitude; userLon = pos.coords.longitude; coordsReady = true; setLocationEntities(userLat, userLon); },
          () => { /* abaikan */ },
          { enableHighAccuracy: true, timeout: 10000 }
        );
      }
      const hiro = document.getElementById('hiro-marker');
      hiro.addEventListener('markerFound', () => {
        if (!coordsReady && navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => { userLat = pos.coords.latitude; userLon = pos.coords.longitude; coordsReady = true; setLocationEntities(userLat, userLon); Object.values(entities).forEach(e => e.setAttribute('visible', true)); },
            () => { Object.values(entities).forEach(e => e.setAttribute('visible', true)); },
            { enableHighAccuracy: true, timeout: 10000 }
          );
        } else {
          Object.values(entities).forEach(e => e.setAttribute('visible', true));
        }
      });
    </script>
  </body>
</html>
